<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HSC BUET Tracker v2 Pro (Single File)</title>
<style>
:root{
  --bg:#f7f6f3; --card:#fff; --text:#37352f; --muted:#787774;
  --accent:#667eea; --accent2:#764ba2; --ok:#25a55f;
}
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;background:var(--bg);color:var(--text)}
.header{position:sticky;top:0;z-index:20;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;padding:16px 18px;box-shadow:0 4px 12px rgba(0,0,0,.18)}
.header h1{margin:0 0 4px;font-size:20px}
.header .sub{font-size:12px;opacity:.9}
.tabs{display:flex;gap:8px;padding:12px;overflow:auto;background:#fff;border-bottom:1px solid #eee}
.tab{border:none;background:#f0efec;padding:9px 12px;border-radius:8px;white-space:nowrap;cursor:pointer}
.tab.active{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
.container{max-width:980px;margin:0 auto;padding:14px}
.card{background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.row{display:flex;justify-content:space-between;align-items:center;gap:10px}
.muted{color:var(--muted);font-size:13px}
.big{font-size:36px;font-weight:700;color:var(--accent)}
.grid{display:grid;grid-template-columns:1fr;gap:10px}
@media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}
.chapter{background:#fff;border-radius:12px;padding:12px;margin:10px 0;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.task{display:flex;align-items:center;gap:8px;background:#fafaf9;padding:8px;border-radius:8px;margin-top:8px}
.bar{height:8px;background:#e9e9e7;border-radius:4px;overflow:hidden;margin-top:10px}
.fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--ok))}
.small{font-size:12px}
.btn{border:none;background:var(--accent);color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer}
select{padding:6px;border-radius:8px;border:1px solid #ddd}
.hidden{display:none}
</style>
</head>
<body>
<div class="header">
  <h1>ðŸ“š HSC BUET Tracker v2 PRO</h1>
  <div class="sub" id="subtitle"></div>
</div>

<div class="tabs" id="tabs"></div>

<div class="container">
  <div id="page"></div>
</div>

<script>
/* ========= i18n ========= */
const LANG = {
  bn: {dashboard:"à¦¡à§à¦¯à¦¾à¦¶à¦¬à§‹à¦°à§à¦¡", settings:"à¦¸à§‡à¦Ÿà¦¿à¦‚à¦¸", progress:"à¦¸à¦®à§à¦ªà¦¨à§à¦¨", completed:"à¦¶à§‡à¦·", overall:"à¦¸à¦¾à¦®à¦—à§à¦°à¦¿à¦• à¦…à¦—à§à¦°à¦—à¦¤à¦¿",
       countdown:"à¦ªà¦°à§€à¦•à§à¦·à¦¾à¦° à¦•à¦¾à¦‰à¦¨à§à¦Ÿà¦¡à¦¾à¦‰à¦¨", daysLeft:"à¦¦à¦¿à¦¨ à¦¬à¦¾à¦•à¦¿", language:"à¦­à¦¾à¦·à¦¾", theme:"à¦¥à¦¿à¦®", export:"Export Data",
       import:"Import Data", reset:"Reset All", light:"Light", dark:"Dark", examReady:"Exam readiness"},
  en: {dashboard:"Dashboard", settings:"Settings", progress:"Completed", completed:"Done", overall:"Overall Progress",
       countdown:"Exam Countdown", daysLeft:"days left", language:"Language", theme:"Theme", export:"Export Data",
       import:"Import Data", reset:"Reset All", light:"Light", dark:"Dark", examReady:"Exam readiness"}
};

/* ========= Data (BUET weighted) ========= */
const SUBJECTS = {
  "Physics": {
    chapters: [
      {name:"Mechanics", weight:3},
      {name:"Thermodynamics", weight:3},
      {name:"Electricity", weight:3},
      {name:"Optics", weight:2}
    ],
    tasks:["Main Book","Board Questions","Question Bank","Guide"]
  },
  "Chemistry": {
    chapters: [
      {name:"Organic",weight:3},
      {name:"Physical",weight:3},
      {name:"Inorganic",weight:2}
    ],
    tasks:["Main Book","Board Questions","Question Bank","Guide"]
  },
  "Higher Math": {
    chapters: [
      {name:"Integration",weight:3},
      {name:"Differentiation",weight:3},
      {name:"Coordinate Geometry",weight:2}
    ],
    tasks:["Main Book","Board Questions","Question Bank","Guide"]
  },
  "Biology": {
    chapters: [
      {name:"Cell Biology",weight:2},
      {name:"Human Physiology",weight:2}
    ],
    tasks:["Main Book","Board Questions"]
  }
};

const STORAGE_KEY = "hsc_buet_tracker_v2_single";

/* ========= State ========= */
let STATE = {
  language:"bn",
  theme:"light",
  examDate:"2026-08-01",
  subjects:{},
  lastSaved:null
};

function initState(){
  const saved = localStorage.getItem(STORAGE_KEY);
  if(saved){
    try{ STATE = {...STATE, ...JSON.parse(saved)} }catch(e){}
  }
  // build subjects if missing
  Object.entries(SUBJECTS).forEach(([s,info])=>{
    if(!STATE.subjects[s]) STATE.subjects[s]={chapters:{}};
    info.chapters.forEach(ch=>{
      const id = slug(s+"_"+ch.name);
      if(!STATE.subjects[s].chapters[id]){
        STATE.subjects[s].chapters[id]={
          name:ch.name, weight:ch.weight,
          tasks: info.tasks.map(t=>({name:t,done:false})),
          revision:0
        };
      }
    });
  });
  save();
}

function save(){
  STATE.lastSaved = new Date().toISOString();
  localStorage.setItem(STORAGE_KEY, JSON.stringify(STATE));
}

function slug(s){ return s.toLowerCase().replace(/[^a-z0-9]+/g,"_"); }

/* ========= Progress Engine ========= */
function chapterProgress(ch){
  const total = ch.tasks.length;
  const done = ch.tasks.filter(t=>t.done).length;
  return total? Math.round(done/total*100):0;
}
function subjectProgress(subjectName){
  const chs = Object.values(STATE.subjects[subjectName].chapters);
  let num=0, den=0;
  chs.forEach(ch=>{ num += chapterProgress(ch)*ch.weight; den += ch.weight; });
  return den? Math.round(num/den):0;
}
function overallProgress(){
  const subs = Object.keys(SUBJECTS);
  if(!subs.length) return 0;
  const sum = subs.reduce((a,s)=>a+subjectProgress(s),0);
  return Math.round(sum/subs.length);
}

/* ========= UI ========= */
let currentPage="dashboard";

function t(k){ return LANG[STATE.language][k] || k; }

function renderTabs(){
  const tabs = document.getElementById("tabs");
  tabs.innerHTML="";
  const names=[["dashboard",t("dashboard")], ...Object.keys(SUBJECTS).map(s=>[s,s]), ["settings",t("settings")]];
  names.forEach(([id,label])=>{
    const b=document.createElement("button");
    b.className="tab"+(currentPage===id?" active":"");
    b.textContent=label;
    b.onclick=()=>{currentPage=id; renderAll();};
    tabs.appendChild(b);
  });
}

function renderDashboard(){
  const p = overallProgress();
  const examDate = new Date(STATE.examDate);
  const now = new Date();
  const days = Math.max(0, Math.ceil((examDate-now)/(1000*60*60*24)));

  let html = `
  <div class="grid">
    <div class="card">
      <div class="muted">${t("overall")}</div>
      <div class="big">${p}%</div>
      <div class="muted">${t("examReady")}: ${p}%</div>
    </div>
    <div class="card">
      <div class="muted">${t("countdown")}</div>
      <div class="big">${days}</div>
      <div class="muted">${t("daysLeft")}</div>
    </div>
  </div>
  <div class="card">
    <div class="muted">Subject Progress</div>
  `;
  Object.keys(SUBJECTS).forEach(s=>{
    html += `<div class="row" style="margin-top:8px"><b>${s}</b><b>${subjectProgress(s)}%</b></div>`;
  });
  html += `</div>`;
  return html;
}

function renderSubject(name){
  let html=`<div class="card"><b>${name}</b> â€” ${subjectProgress(name)}%</div>`;
  const chapters = Object.entries(STATE.subjects[name].chapters);
  chapters.forEach(([id,ch])=>{
    const prog = chapterProgress(ch);
    html += `<div class="chapter">
      <div class="row"><b>${ch.name}</b><span class="small">weight ${ch.weight}</span></div>`;
    ch.tasks.forEach((task,idx)=>{
      html += `<label class="task">
        <input type="checkbox" ${task.done?"checked":""}
          onchange="toggleTask('${name}','${id}',${idx},this.checked)">
        <span>${task.name}</span>
      </label>`;
    });
    html += `<div class="bar"><div class="fill" style="width:${prog}%"></div></div>
             <div class="small">${prog}% ${t("progress")}</div>
    </div>`;
  });
  return html;
}

function renderSettings(){
  return `
  <div class="card">
    <div class="row">
      <label>${t("language")}</label>
      <select onchange="setLang(this.value)">
        <option value="bn" ${STATE.language==="bn"?"selected":""}>à¦¬à¦¾à¦‚à¦²à¦¾</option>
        <option value="en" ${STATE.language==="en"?"selected":""}>English</option>
      </select>
    </div>
  </div>
  <div class="card">
    <div class="row">
      <label>${t("theme")}</label>
      <select onchange="setTheme(this.value)">
        <option value="light" ${STATE.theme==="light"?"selected":""}>${t("light")}</option>
        <option value="dark" ${STATE.theme==="dark"?"selected":""}>${t("dark")}</option>
      </select>
    </div>
  </div>
  <div class="card">
    <button class="btn" onclick="exportData()">${t("export")}</button>
    <button class="btn" onclick="importData()" style="margin-left:8px">${t("import")}</button>
    <button class="btn" onclick="resetAll()" style="margin-left:8px;background:#dc3545">${t("reset")}</button>
  </div>
  <div class="card small muted">Last saved: ${STATE.lastSaved || "-"}</div>
  `;
}

function applyTheme(){
  if(STATE.theme==="dark"){
    document.documentElement.style.setProperty('--bg','#171717');
    document.documentElement.style.setProperty('--card','#222');
    document.documentElement.style.setProperty('--text','#f2f2f2');
    document.documentElement.style.setProperty('--muted','#bdbdbd');
  } else {
    document.documentElement.style.setProperty('--bg','#f7f6f3');
    document.documentElement.style.setProperty('--card','#fff');
    document.documentElement.style.setProperty('--text','#37352f');
    document.documentElement.style.setProperty('--muted','#787774');
  }
}

function renderAll(){
  applyTheme();
  document.getElementById("subtitle").textContent = "Single-file GitHub version â€¢ auto-saved locally";
  renderTabs();
  const page = document.getElementById("page");
  if(currentPage==="dashboard") page.innerHTML = renderDashboard();
  else if(currentPage==="settings") page.innerHTML = renderSettings();
  else page.innerHTML = renderSubject(currentPage);
}

/* ========= Actions ========= */
function toggleTask(subject,id,idx,val){
  STATE.subjects[subject].chapters[id].tasks[idx].done = val;
  save();
  renderAll();
}
function setLang(v){ STATE.language=v; save(); renderAll(); }
function setTheme(v){ STATE.theme=v; save(); renderAll(); }

function exportData(){
  const blob = new Blob([JSON.stringify(STATE,null,2)], {type:"application/json"});
  const a=document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "hsc_tracker_backup.json";
  a.click();
}
function importData(){
  const inp=document.createElement("input");
  inp.type="file"; inp.accept=".json";
  inp.onchange=e=>{
    const f=e.target.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=()=>{
      try{
        STATE = {...STATE, ...JSON.parse(r.result)};
        save(); renderAll();
        alert("Imported successfully.");
      }catch(err){ alert("Invalid file."); }
    };
    r.readAsText(f);
  };
  inp.click();
}
function resetAll(){
  if(confirm("Reset all progress?")){
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
}

/* ========= Boot ========= */
initState();
renderAll();
</script>
</body>
</html>
